# File Upload Feature - Architecture Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                            â”‚
â”‚                   (CivicCompanion Component)                     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Chat Messages Display                                   â”‚   â”‚
â”‚  â”‚  - User messages                                         â”‚   â”‚
â”‚  â”‚  - Assistant responses                                   â”‚   â”‚
â”‚  â”‚  - System instructions                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  File Upload Section                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Upload Button (ğŸ“¤) â†’ File Input Dialog             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ File Preview Panel (if file selected)              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - File name                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - File size                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Analyze button                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Cancel button                                    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Error Display (if validation fails)                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Error message                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Dismiss button                                   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Input Area                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Text input for chat                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Upload button                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ - Send button                                      â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FILE PROCESSING LAYER                         â”‚
â”‚                    (fileProcessor.ts)                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ validateFile()                                           â”‚   â”‚
â”‚  â”‚ - Check file type (PDF, DOCX, DOC, TXT)                â”‚   â”‚
â”‚  â”‚ - Check file size (max 10MB)                            â”‚   â”‚
â”‚  â”‚ - Return validation result                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ extractTextFromFile()                                    â”‚   â”‚
â”‚  â”‚ - Route to appropriate extractor                        â”‚   â”‚
â”‚  â”‚ - Handle errors                                         â”‚   â”‚
â”‚  â”‚ - Return extracted text                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†™              â†“              â†˜                          â”‚
â”‚    PDF              DOCX              TXT                        â”‚
â”‚    â†“                 â†“                 â†“                         â”‚
â”‚  extractTextFromPDF  extractTextFromDOCX  file.text()           â”‚
â”‚  (pdf.js)           (mammoth)                                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API LAYER                                   â”‚
â”‚              (Supabase Edge Function)                            â”‚
â”‚                                                                   â”‚
â”‚  POST /make-server-8457b97f/analyze-document                    â”‚
â”‚                                                                   â”‚
â”‚  Request:                                                        â”‚
â”‚  {                                                               â”‚
â”‚    "documentContent": "extracted text...",                      â”‚
â”‚    "fileName": "document.pdf"                                   â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ANALYSIS ENGINE                                 â”‚
â”‚              (Backend Analysis Functions)                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ generateSystemInstructions()                             â”‚   â”‚
â”‚  â”‚ - Main orchestration function                            â”‚   â”‚
â”‚  â”‚ - Calls all analysis functions                           â”‚   â”‚
â”‚  â”‚ - Formats output                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Document Classification                                  â”‚   â”‚
â”‚  â”‚ - Detect: Government Doc, Scheme, Service Guide, Policy â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ extractKeyTopics()                                       â”‚   â”‚
â”‚  â”‚ - Search for civic service keywords                      â”‚   â”‚
â”‚  â”‚ - Extract relevant sentences                             â”‚   â”‚
â”‚  â”‚ - Return top 10 topics                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ extractDocumentSummary()                                 â”‚   â”‚
â”‚  â”‚ - Extract first 3 sentences                              â”‚   â”‚
â”‚  â”‚ - Filter by length                                       â”‚   â”‚
â”‚  â”‚ - Return summary                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ generateCivicGuidance()                                  â”‚   â”‚
â”‚  â”‚ - Match content to civic services                        â”‚   â”‚
â”‚  â”‚ - Generate relevant guidance                             â”‚   â”‚
â”‚  â”‚ - Include helpful links                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ generateActionItems()                                    â”‚   â”‚
â”‚  â”‚ - Determine action type (apply, renew, verify, etc.)    â”‚   â”‚
â”‚  â”‚ - Generate step-by-step actions                          â”‚   â”‚
â”‚  â”‚ - Return numbered list                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RESPONSE                                    â”‚
â”‚                                                                   â”‚
â”‚  {                                                               â”‚
â”‚    "systemInstructions": "# Civic Life Companion...",          â”‚
â”‚    "timestamp": "2024-01-15T10:30:00.000Z"                     â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DISPLAY RESULTS                               â”‚
â”‚                                                                   â”‚
â”‚  - Add user message to chat                                      â”‚
â”‚  - Add system instructions as assistant message                  â”‚
â”‚  - Display in formatted markdown                                 â”‚
â”‚  - User can scroll and read full instructions                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  Selects    â”‚
â”‚   File      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  File Validation        â”‚
â”‚  - Format check         â”‚
â”‚  - Size check           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Invalid â”€â”€â†’ Show Error Message
       â”‚
       â”œâ”€ Valid â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚            â”‚ Show File Preview â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
       â”‚                     â†“
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚            â”‚ User Clicks      â”‚
       â”‚            â”‚ Analyze          â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
       â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Extract Text from File              â”‚
â”‚  - PDF: pdf.js extraction            â”‚
â”‚  - DOCX: mammoth extraction          â”‚
â”‚  - TXT: direct read                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Error â”€â”€â†’ Show Error Message
       â”‚
       â”œâ”€ Success â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚ Send to API          â”‚
       â”‚              â”‚ /analyze-document    â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚
       â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Analysis                    â”‚
â”‚  - Classify document                 â”‚
â”‚  - Extract topics                    â”‚
â”‚  - Generate summary                  â”‚
â”‚  - Create guidance                   â”‚
â”‚  - Generate actions                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Error â”€â”€â†’ Show Error Message
       â”‚
       â”œâ”€ Success â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚ Return Instructions  â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚
       â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Display Results                     â”‚
â”‚  - Add to chat history               â”‚
â”‚  - Format as markdown                â”‚
â”‚  - Show in message bubble            â”‚
â”‚  - User can read and follow          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Interaction Diagram

```
CivicCompanion.tsx
â”‚
â”œâ”€ State Management
â”‚  â”œâ”€ messages: Message[]
â”‚  â”œâ”€ inputMessage: string
â”‚  â”œâ”€ uploadedFile: File | null
â”‚  â”œâ”€ uploadError: string
â”‚  â””â”€ fileInputRef: React.Ref
â”‚
â”œâ”€ Event Handlers
â”‚  â”œâ”€ handleFileSelect()
â”‚  â”‚  â””â”€ calls validateFile()
â”‚  â”‚
â”‚  â”œâ”€ handleAnalyzeFile()
â”‚  â”‚  â”œâ”€ calls extractTextFromFile()
â”‚  â”‚  â””â”€ calls fetch(/analyze-document)
â”‚  â”‚
â”‚  â””â”€ handleSendMessage()
â”‚     â””â”€ calls fetch(/chat)
â”‚
â”œâ”€ UI Components
â”‚  â”œâ”€ Header
â”‚  â”œâ”€ Messages Display
â”‚  â”œâ”€ Error Panel
â”‚  â”œâ”€ File Preview Panel
â”‚  â””â”€ Input Area
â”‚
â””â”€ Dependencies
   â”œâ”€ fileProcessor.ts
   â”‚  â”œâ”€ validateFile()
   â”‚  â”œâ”€ extractTextFromFile()
   â”‚  â”œâ”€ extractTextFromPDF()
   â”‚  â”œâ”€ extractTextFromDOCX()
   â”‚  â””â”€ extractTextFromDOC()
   â”‚
   â””â”€ API Endpoints
      â”œâ”€ /chat
      â””â”€ /analyze-document
```

## File Processing Pipeline

```
Input File
    â”‚
    â”œâ”€ PDF (.pdf)
    â”‚  â”‚
    â”‚  â”œâ”€ pdf.js loads file
    â”‚  â”œâ”€ Iterate through pages
    â”‚  â”œâ”€ Extract text from each page
    â”‚  â””â”€ Combine text
    â”‚
    â”œâ”€ DOCX (.docx)
    â”‚  â”‚
    â”‚  â”œâ”€ mammoth reads file
    â”‚  â”œâ”€ Parse document structure
    â”‚  â”œâ”€ Extract all text
    â”‚  â””â”€ Return combined text
    â”‚
    â”œâ”€ DOC (.doc)
    â”‚  â”‚
    â”‚  â””â”€ Recommend conversion to .docx
    â”‚
    â””â”€ TXT (.txt)
       â”‚
       â””â”€ Direct file.text() read

    â†“
    
Extracted Text
    â”‚
    â”œâ”€ Clean and normalize
    â”œâ”€ Remove extra whitespace
    â”œâ”€ Preserve structure
    â””â”€ Return to frontend

    â†“

Send to API
    â”‚
    â””â”€ POST /analyze-document
       â”œâ”€ documentContent: string
       â””â”€ fileName: string
```

## Analysis Engine Pipeline

```
Document Content
    â”‚
    â”œâ”€ Classification Detection
    â”‚  â”œâ”€ Check for "government" keywords
    â”‚  â”œâ”€ Check for "scheme" keywords
    â”‚  â”œâ”€ Check for "procedure" keywords
    â”‚  â””â”€ Check for "policy" keywords
    â”‚
    â”œâ”€ Topic Extraction
    â”‚  â”œâ”€ Search civic service keywords
    â”‚  â”‚  â”œâ”€ Aadhaar, PAN, Passport, etc.
    â”‚  â”‚  â””â”€ Certificates, IDs, etc.
    â”‚  â”‚
    â”‚  â”œâ”€ Extract relevant sentences
    â”‚  â”‚  â”œâ”€ Split by punctuation
    â”‚  â”‚  â”œâ”€ Filter by length
    â”‚  â”‚  â””â”€ Limit to 10 topics
    â”‚  â”‚
    â”‚  â””â”€ Return topic list
    â”‚
    â”œâ”€ Summary Generation
    â”‚  â”œâ”€ Extract first 3 sentences
    â”‚  â”œâ”€ Filter by length (20-150 chars)
    â”‚  â””â”€ Return summary
    â”‚
    â”œâ”€ Guidance Generation
    â”‚  â”œâ”€ Match content to services
    â”‚  â”‚  â”œâ”€ Aadhaar â†’ UIDAI guidance
    â”‚  â”‚  â”œâ”€ PAN â†’ NSDL guidance
    â”‚  â”‚  â”œâ”€ Passport â†’ Passport India guidance
    â”‚  â”‚  â””â”€ Schemes â†’ PM Schemes guidance
    â”‚  â”‚
    â”‚  â””â”€ Return formatted guidance
    â”‚
    â””â”€ Action Items Generation
       â”œâ”€ Detect action type
       â”‚  â”œâ”€ Application â†’ Apply steps
       â”‚  â”œâ”€ Renewal â†’ Renewal steps
       â”‚  â”œâ”€ Scheme â†’ Eligibility steps
       â”‚  â””â”€ General â†’ General steps
       â”‚
       â””â”€ Return numbered actions

    â†“

System Instructions
    â”‚
    â”œâ”€ Document Classification
    â”œâ”€ Key Topics
    â”œâ”€ Document Summary
    â”œâ”€ Civic Guidance
    â””â”€ Recommended Actions

    â†“

Return to Frontend
    â”‚
    â””â”€ Display in Chat
```

## Error Handling Flow

```
File Upload
    â”‚
    â”œâ”€ Validation Error
    â”‚  â”œâ”€ Invalid format
    â”‚  â”‚  â””â”€ Show: "Unsupported file format..."
    â”‚  â”‚
    â”‚  â””â”€ File too large
    â”‚     â””â”€ Show: "File size exceeds 10MB..."
    â”‚
    â”œâ”€ Extraction Error
    â”‚  â”œâ”€ PDF corrupted
    â”‚  â”‚  â””â”€ Show: "Error analyzing document..."
    â”‚  â”‚
    â”‚  â”œâ”€ DOCX parsing failed
    â”‚  â”‚  â””â”€ Show: "Error analyzing document..."
    â”‚  â”‚
    â”‚  â””â”€ File read error
    â”‚     â””â”€ Show: "Error analyzing document..."
    â”‚
    â”œâ”€ API Error
    â”‚  â”œâ”€ Authentication failed
    â”‚  â”‚  â””â”€ Show: "Unauthorized"
    â”‚  â”‚
    â”‚  â”œâ”€ Server error
    â”‚  â”‚  â””â”€ Show: "Failed to analyze document"
    â”‚  â”‚
    â”‚  â””â”€ Network error
    â”‚     â””â”€ Show: "Error analyzing document..."
    â”‚
    â””â”€ Success
       â””â”€ Display system instructions
```

## State Transitions

```
Initial State
    â”‚
    â”œâ”€ uploadedFile: null
    â”œâ”€ uploadError: ""
    â””â”€ isLoading: false

    â†“

User Selects File
    â”‚
    â”œâ”€ If invalid
    â”‚  â”œâ”€ uploadedFile: null
    â”‚  â”œâ”€ uploadError: "error message"
    â”‚  â””â”€ isLoading: false
    â”‚
    â””â”€ If valid
       â”œâ”€ uploadedFile: File
       â”œâ”€ uploadError: ""
       â””â”€ isLoading: false

    â†“

User Clicks Analyze
    â”‚
    â”œâ”€ uploadedFile: File
    â”œâ”€ uploadError: ""
    â””â”€ isLoading: true

    â†“

Analysis Complete
    â”‚
    â”œâ”€ uploadedFile: null
    â”œâ”€ uploadError: ""
    â””â”€ isLoading: false

    â†“

Results Displayed
    â”‚
    â””â”€ Ready for next upload
```

---

This architecture ensures a smooth, efficient flow from file upload through analysis to result display, with comprehensive error handling at each stage.
